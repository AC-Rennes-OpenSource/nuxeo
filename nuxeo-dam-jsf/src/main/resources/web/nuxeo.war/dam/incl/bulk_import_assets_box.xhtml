<div xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:a4j="http://richfaces.org/a4j"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:nxh="http://nuxeo.org/nxweb/html"
  xmlns:nxl="http://nuxeo.org/nxforms/layout"
  xmlns:nxd="http://nuxeo.org/nxweb/document">

  <h3><h:outputText value="#{messages['label.dam.bulk.import.assets']}" /></h3>

  <h:form enctype="multipart/form-data" id="#{fancyboxFormId}">

    <div class="content positionR">

      <nxu:set var="importOptions" value="#{damImportActions.getImportOptions(action.properties.dropContext)}" cache="true">

      <table class="dataInput fullWidth">
        <tbody>
        <tr>
          <td class="labelColumn">
            #{messages['label.dam.bulk.import.assets.select.location']}
          </td>
          <td class="fieldColumn">
            <nxl:widgetType name="damSingleDocumentSuggestion" mode="edit"
              value="#{damImportActions}"
              field="selectedImportFolderId"
              pageProviderName="damImportFolders"
              placeholder="#{messages['label.dam.bulk.import.assets.select.location.placeholder']}"
              prefixSearch="true" />
          </td>
        </tr>
        <tr>
          <td class="labelColumn">
            #{messages['label.dam.bulk.import.assets.select.location']}
          </td>
          <td class="fieldColumn">
            <c:if test="#{useHtml5DragAndDrop}">
              <div class="damAssetImportZone" id="#{action.id}_dropzone" context="#{action.properties.dropContext}">
                <div class="dropArea dropZoneLabel jsTips">
                  #{messages['label.dam.bulk.import.assets.tips']}
                </div>
              </div>
            </c:if>

            <c:if test="#{!useHtml5DragAndDrop}">
              <rich:fileUpload id="fileUploadForm" uploadData="#{damImportActions.uploadedFiles}"
                maxFilesQuantity="10" immediateUpload="true"
                locale="#{localeSelector.localeString}"
                ajaxSingle="true"
                onadd="nuxeo.dam.disableBulkImportButton();"
                onuploadcomplete="nuxeo.dam.enableBulkImportButton();"
                listWidth="60%" listHeight="150px">
              </rich:fileUpload>
            </c:if>
          </td>
        </tr>
        <c:if test="#{importOptions.size() > 1}">
        <tr>
          <td class="labelColumn">
            #{messages['label.dam.bulk.import.assets.select.option']}
          </td>
          <td class="fieldColumn">
            <h:selectOneMenu
              value="#{damImportActions.selectedImportOptionId}"
              id="#{widget.id}" styleClass="langSelect">
              <a4j:support event="onchange"
                reRender="importLayout_panel" />
              <nxu:selectItems
                var="importOption" value="#{importOptions}"
                itemValue="#{importOption.id}" itemLabel="#{messages[importOption.label]}" />
            </h:selectOneMenu>
          </td>
        </tr>
        </c:if>
        </tbody>
      </table>

      </nxu:set>

      <a4j:outputPanel id="importLayout_panel">

        <nxl:layout name="#{damImportActions.selectedImportOption.properties.layout}" mode="create"
          value="#{damImportActions.importDocumentModel}"/>

        <!-- <nxl:widgetType name="layout" mode="create"
          value="#{damImportActions.importDocumentModel}"
          widgetProperty_name="#{damImportActions.selectedImportOption.properties.layout}"/> -->

      </a4j:outputPanel>

    </div>

    <div class="buttonsGadget">
      <nxh:commandButton value="#{messages['command.import']}"
        action="#{damImportActions.importAssets()}"
        styleClass="button jsDamImportButton" />
      <nxh:commandButton value="#{messages['command.cancel']}"
        immediate="true"
        action="#{damImportActions.cancel()}"
        styleClass="button" />
    </div>




    <script type="text/javascript">
      <c:if test="#{useHtml5DragAndDrop}">
        jQuery(".damAssetImportZone").nxDropZone({
          url : "#{contextPath}/site/automation/",
          uploadRateRefreshTime : 500,
          numConcurrentUploads : 3,
          dropContext : ctx,
          uploadTimeout : #{frameworkPropertyActions.getProperty("org.nuxeo.dnd.upload.timeout","30000")},
          execTimeout : #{frameworkPropertyActions.getProperty("org.nuxeo.dnd.exec.timeout","30000")},
          extendedModeTimeout : #{frameworkPropertyActions.getProperty("org.nuxeo.dnd.extendedmode.timeout","2000")},
          handler : nuxeo.dam.createDamImportAssetHandler("#{damImportActions.generateBatchId()}")
        });
      </c:if>
      nuxeo.dam.disableBulkImportButton();
    </script>

  </h:form>

</div>
