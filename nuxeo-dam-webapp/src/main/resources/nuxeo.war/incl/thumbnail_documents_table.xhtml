<div xmlns="http://www.w3.org/1999/xhtml"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:a4j="http://richfaces.org/a4j"
  xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:nxh="http://nuxeo.org/nxweb/html"
  xmlns:nxd="http://nuxeo.org/nxweb/document"
  xmlns:rich="http://richfaces.org/rich">

   
<script type="text/javascript" src="/nuxeo/scripts/jquery.js"></script>
<!-- The jQuery.noConflict() is necessary or else things start breaking like the import dialog popup -->    
<script type="text/javascript">jQuery.noConflict();</script>    
<script type="text/javascript" src="/nuxeo/scripts/jquery.event.extendedclick.js"></script>   
<script type="text/javascript">
var currentId = -1;
    
(function($){$(document).ready(function(){

	$(document).ctrlclick(function(e) {
		// alert($(this));
		// alert(jQuery);
			
		if(currentId >= 0) {
			eval("link" + currentId + "();")
			currentId = -1;
		}
	});
	
})})(jQuery);
</script>
    
  <rich:dataGrid
    id="dataTable"
    value="#{documents.rows}"
    var="row"
    rowKeyVar="rowKey"
    columns="4"
    rendered="#{documents.rowCount > 0}">

      <rich:panel>
        <div docRef="#{row.data.ref}" id="#{row.data.ref}" name="#{rowKey}"
             class="thumbViewElement #{nxu:test(documentActions.currentSelection == row.data, 'selected', '')} #{nxu:test(documentActions.getIsCurrentSelectionInWorkingList(row.data.ref, providerName, 'CURRENT_SELECTION'), 'selectedCtrlClick', '')}"
                ondblclick="dblclick = true;}'" onclick="currentId=#{rowKey};">
             <script type="text/javascript">
                    var dblclick;

                    function link<h:outputText value="#{rowKey}" />(){
	                        if(!dblclick){
	                           if (document.getElementById('<h:outputText value="#{row.data.ref}" />').getAttribute('class')==('thumbViewElement selected selectedCtrlClick')){	                       
	                               document.getElementById('docRefDiv:<h:outputText value="#{row.data.ref}" />').childNodes[0].checked=false;
	                               document.getElementById('<h:outputText value="#{row.data.ref}" />').className='thumbViewElement selected';
	                           }else if (document.getElementById('<h:outputText value="#{row.data.ref}" />').getAttribute('class')==('thumbViewElement selectedCtrlClick')){	                       
	                               document.getElementById('docRefDiv:<h:outputText value="#{row.data.ref}" />').childNodes[0].checked=false;
	                               document.getElementById('<h:outputText value="#{row.data.ref}" />').className='thumbViewElement';
	                           }else if (document.getElementById('<h:outputText value="#{row.data.ref}" />').getAttribute('class')==('thumbViewElement selected')){	                       
	                               document.getElementById('docRefDiv:<h:outputText value="#{row.data.ref}" />').childNodes[0].checked=true;
	                               document.getElementById('<h:outputText value="#{row.data.ref}" />').className='thumbViewElement selected selectedCtrlClick';
		                       }else{
	                               document.getElementById('docRefDiv:<h:outputText value="#{row.data.ref}" />').childNodes[0].checked=true;
	                               document.getElementById('<h:outputText value="#{row.data.ref}" />').className='thumbViewElement selectedCtrlClick';
	                           }
	                           selectDataTableRow('<h:outputText value="#{row.data.ref}" />' , 
	                             '<h:outputText value="#{providerName}" />',
	                             document.getElementById('docRefDiv:<h:outputText value="#{row.data.ref}" />').childNodes[0],
	                             null);                          
	                        } else {

	                        }

                    }
              </script>
       		  <div id="docRefDiv:#{row.data.ref}" style="display: none;" >
                <h:selectBooleanCheckbox value="#{row.selected}"  />
              </div>
              <!-- div id="docRefTarget:#{row.data.ref}" style="background-color:yellow;" 
                ondblclick="dblclick = true; window.location.href = '#{nxd:documentUrl(row.data)}'"
                onclick="setTimeout(link#{rowKey}, 300)">
              </div --> 
                
        <h:panelGrid>
          <a4j:commandLink id="imageLink" styleClass="thumbViewPictureLink"  action="#{documentActions.setCurrentSelection(row.data)}" reRender="dataTable, selectionView">
            <nxh:graphicImage id="theImage"
              url="#{nxd:fileUrl('downloadPicture', row.data, 'Thumbnail:content', row.data.dublincore.modified)}?conversationId=#{conversation.id}"
              style="max-height: 80px; max-width:125px;"
              rendered="#{row.data.hasSchema('picture')}"
              styleClass="thumbViewPicture"/>
            <nxh:graphicImage id="theVideo"
              value="/icons/video_big.png"
              style="max-height: 90px; max-width:140px;"
              rendered="#{row.data.hasSchema('video')}"
              styleClass="thumbViewPicture"/>
            <nxh:graphicImage id="theAudio"
              value="/icons/audio_big.png"
              style="max-height: 90px; max-width:140px;"
              rendered="#{row.data.hasSchema('audio')}"
              styleClass="thumbViewPicture"/>
            <nxh:graphicImage value="/icons/office_big.png"
              style="max-height: 90px; max-width:140px;"
              rendered="#{!row.data.hasSchema('picture') and !row.data.hasSchema('video') and !row.data.hasSchema('audio')}"
              styleClass="thumbViewPicture"/>
          </a4j:commandLink>
          <h:panelGroup>
            <span id="title_#{row.data.ref}" class="#{nxu:test(documentActions.currentSelection == row.data, 'selected', '')}">
              <a4j:commandLink id="titleLink" action="#{documentActions.setCurrentSelection(row.data)}" reRender="dataTable, selectionView">
                <nxh:outputText value="#{documentActions.getTitleCropped(row.data, 15)}"
                  title="#{row.data.dc.title}"
                  styleClass="thumbViewTitle"/>
              </a4j:commandLink>
            </span>
          </h:panelGroup>
          <h:panelGroup rendered="#{!empty row.data.dam_common.author}" id="damcAuthor">
            <h:outputText class="thumbViewlabel" value="#{messages['label.content.thumbnail.by']} " />
	        <h:outputText value="#{row.data.dam_common.author}" />
          </h:panelGroup>
          <h:panelGroup rendered="#{!empty row.data.dam_common.authoringDate}" id="damcAuthoringDate">
            <h:outputText class="thumbViewlabel" value="#{messages['label.content.thumbnail.creation']} " />
            <h:outputText value="#{row.data.dam_common.authoringDate}">
              <f:convertDateTime pattern="#{nxu:basicDateFormater()}"
                timeZone="#{timeZone}" />
            </h:outputText>
          </h:panelGroup>

          <h:panelGroup>
            <h:outputText class="thumbViewlabel" value="#{messages['label.content.thumbnail.size']} " />
            <h:outputText value="#{nxu:printFormatedFileSize(row.data.picture.views[1].content.length, 'JEDEC', true)}" rendered="#{row.data.hasSchema('picture') and !empty row.data.picture.views}" />
            <h:outputText value="#{nxu:printFormatedFileSize(row.data.file.content.length, 'JEDEC', true)}" rendered="#{row.data.hasSchema('file')}" />
          </h:panelGroup>
        </h:panelGrid>

      </div></rich:panel>

  </rich:dataGrid>
       <a4j:commandLink id="deleteLink" action="#{bulkSelectActions.deleteSelection}" reRender="dataTable, selectionView">
       <nxh:outputText value="delete"
         title="delete"/>
     </a4j:commandLink>

</div>
