<div xmlns:nxu="http://nuxeo.org/nxweb/util"
     xmlns:ui="http://java.sun.com/jsf/facelets"
     xmlns:f="http://java.sun.com/jsf/core"
     xmlns:h="http://java.sun.com/jsf/html"
     xmlns:a4j="http://richfaces.org/a4j"
     xmlns:c="http://java.sun.com/jstl/core"
     xmlns:nxh="http://nuxeo.org/nxweb/html"
     xmlns:nxl="http://nuxeo.org/nxforms/layout"
     xmlns:nxd="http://nuxeo.org/nxweb/document">

  <script language="javascript">
    function popupAnnotation(url) {
      width = 1000;
      height = 700;
      top = (window.screen.height - height) / 2;
      left = (window.screen.width - width) / 2;
      popup = window.open(url, '_annotationPopup', 'toolbar=0, scrollbars=1, location=0, statusbar=0, menubar=0, resizable=1, dependent=1, top='+top+', left='+left+', width='+width+', height='+height);
      if(!popup.opener) {
        popup.opener = window;
      }
      return false;
    }
  </script>

  <div class="infoTabContent">
    <a href="#" onclick="return popupAnnotation('#{annotationsActions.annotationsURL}')">
    <nxh:graphicImage id="theImage"
                      url="#{nxd:fileUrl('downloadPicture', documentActions.currentSelection, 'Medium:content', documentActions.currentSelection.dublincore.modified)}?conversationId=#{conversation.id}"
                      style="max-height: 350px;"
                      rendered="#{documentActions.currentSelection.hasSchema('picture')}"/>
    <nxh:graphicImage id="theVideo"
                      value="/icons/video_100.png"
                      style="max-height: 350px;"
                      rendered="#{documentActions.currentSelection.hasSchema('video')}"/>
    <nxh:graphicImage id="theAudio"
                      value="/icons/audio_100.png"
                      style="max-height: 350px;"
                      rendered="#{documentActions.currentSelection.hasSchema('audio')}"/>
    <nxh:graphicImage value="/img/file_preview.png"
                      style="max-height: 350px;"
                      rendered="#{!documentActions.currentSelection.hasSchema('picture') and 
                                  !documentActions.currentSelection.hasSchema('video') and
                                  !documentActions.currentSelection.hasSchema('audio') }"/>
    </a>
    <a4j:form id="assetView">
      <div class="documentPreviewTitle">
        <h4>
          <h:outputText
                  value="#{documentActions.currentSelection.picture.views[1].filename}"
                  rendered="#{documentActions.currentSelection.hasSchema('picture') and !empty documentActions.currentSelection.picture.views}"/>
          <h:outputText
                  value="#{documentActions.currentSelection.file.filename}"
                  rendered="#{documentActions.currentSelection.hasSchema('file')}"/>
        </h4>
      </div>

      <div class="togglePanel">
        <div class="togglePanelTitleBox">
          <h3>
            <a href="#nogo" class="unfolded" onclick="return togglePanel(this)">
              <h:outputText value="#{messages['label.header.info.main.data']}"/>
            </a>
          </h3>
          <div class="dataBlockActions">
          <span>
            <a4j:commandLink styleClass="button"
                             action="#{documentActions.updateCurrentSelection}"
                             rendered="#{documentActions.displayMode == 'edit'}"
                             reRender="assetView, documentsList">
              <h:outputText value="#{messages['command.save']}"/>
            </a4j:commandLink>
          </span>
          <span>
            <a4j:commandLink styleClass="button"
                             action="#{documentActions.toggleDisplayMode}"
                             immediate="true" reRender="assetView">
              <h:outputText value="#{messages['command.cancel']}"
                            rendered="#{documentActions.displayMode == 'edit'}"/>
              <h:outputText value="#{messages['command.edit']}"
                            rendered="#{documentActions.displayMode == 'view'}"/>
            </a4j:commandLink>
          </span>
          </div>
          <div style="clear:both;"></div>
        </div>
        <div class="togglePanelBody">
          <nxl:layout name="heading" mode="#{documentActions.displayMode}"
                      value="#{documentActions.currentSelection}"/>
          <nxl:layout name="damc" mode="#{documentActions.displayMode}"
                      value="#{documentActions.currentSelection}"/>
          <nxl:layout name="dublincore" mode="#{documentActions.displayMode}"
                      value="#{documentActions.currentSelection}"/>

          <h:panelGrid class="dataOutput"
                       columnClasses="labelColumn, fieldColumn" columns="2">
            <h:outputText value="#{messages['label.content.size']}"/>
            <h:panelGroup>
              <h:outputText
                      value="#{documentActions.currentSelection.picture.views[1].content.length}"
                      rendered="#{documentActions.currentSelection.hasSchema('picture') and !empty documentActions.currentSelection.picture.views}"/>
              <h:outputText
                      value="#{documentActions.currentSelection.file.content.length}"
                      rendered="#{documentActions.currentSelection.hasSchema('file')}"/>
            </h:panelGroup>
          </h:panelGrid>
          <h:panelGrid class="dataOutput"
                       columnClasses="labelColumn, fieldColumn" columns="2"
                       rendered="#{documentActions.currentSelection.hasSchema('picture') and !empty documentActions.currentSelection.picture.views}">
            <h:outputText value="#{messages['label.content.height']}"/>
            <h:outputText value="#{currentSelection.picture.views[1].height}"/>

            <h:outputText value="#{messages['label.content.width']}"/>
            <h:outputText value="#{currentSelection.picture.views[1].width}"/>
          </h:panelGrid>
        </div>
      </div>

      <div class="togglePanel">
        <div class="togglePanelTitleBox">
          <h3>
            <a href="#" class="folded" onclick="return togglePanel(this)">
              <h:outputText value="#{messages['label.header.info.iptc']}"/>
            </a>
          </h3>
          <div style="clear:both;"></div>
        </div>
        <div class="togglePanelBody" style="display:none">
          <h:outputText value="#{messages['label.header.info.iptc']}"/>
        </div>
      </div>

      <div class="togglePanel">
        <div class="togglePanelTitleBox">
          <h3>
            <a href="#" class="folded" onclick="return togglePanel(this)">
              <h:outputText value="#{messages['label.header.info.xmp']}"/>
            </a>
          </h3>
          <div style="clear:both;"></div>
        </div>
        <div class="togglePanelBody" style="display:none">
          <h:outputText value="#{messages['label.header.info.xmp']}"/>
        </div>
      </div>

      <div class="togglePanel">
        <div class="togglePanelTitleBox">
          <h3>
            <a href="#" class="folded" onclick="return togglePanel(this)">
              <h:outputText value="#{messages['label.header.info.exif']}"/>
            </a>
          </h3>
          <div style="clear:both;"></div>
        </div>
        <div class="togglePanelBody" style="display: none">
          <nxl:layout name="exif_info" mode="view" value="#{documentActions.currentSelection}"/>
        </div>
      </div>
    </a4j:form>
  </div>

</div>
