<div xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:a4j="http://richfaces.org/a4j"
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:nxh="http://nuxeo.org/nxweb/html"
  xmlns:nxl="http://nuxeo.org/nxforms/layout"
  xmlns:nxd="http://nuxeo.org/nxweb/document">

  <f:subview rendered="false">
    TODO (CB): This can't work since the picture download is done in
    PictureManagerBean which has injected NavigationContext (that is null on DAM)
    Possible solution: re-implement the method in DAM without using the NavigationContext.
    (iframe-preview restlet will be used until a solution is found)
    For more details see: http://jira.nuxeo.org/browse/DAM-171
    <nxh:graphicImage id="theImage" url="#{nxd:complexFileUrl('downloadPicture', documentActions.currentSelection, 'picture:views', 0, 'content', documentActions.currentSelection.picture.views[0].filename)}" />
  </f:subview>

  <iframe class="previewIframe" src="#{documentActions.previewURL}" frameborder="0" height="350px" width="512px" scrolling="auto" id="preview-frame"> </iframe>

  <a4j:form id="assetView">
    <div class="documentPreviewTitle">
      <h4>
        <h:outputText value="#{documentActions.currentSelection.picture.views[1].filename}" rendered="#{documentActions.currentSelection.hasSchema('picture') and !empty documentActions.currentSelection.picture.views}" />
        <h:outputText value="#{documentActions.currentSelection.file.filename}" rendered="#{documentActions.currentSelection.hasSchema('file')}" />
      </h4>
    </div>

    <div class="togglePanel">
      <div class="togglePanelTitleBox">
        <h3>
          <a href="#nogo" class="folded" onclick="return togglePanel(this)">
            <h:outputText value="#{messages['label.header.info.main.data']}" />
          </a>
        </h3>
        <div class="dataBlockActions">
          <span>
            <a4j:commandLink styleClass="button" action="#{documentActions.updateCurrentSelection}" rendered="#{documentActions.displayMode == 'edit'}" reRender="assetView, documentsList" >
              <h:outputText value="#{messages['command.save']}" />
            </a4j:commandLink>
          </span>
          <span>
            <a4j:commandLink styleClass="button" action="#{documentActions.toggleDisplayMode}" immediate="true" reRender="assetView" >
              <h:outputText value="#{messages['command.cancel']}" rendered="#{documentActions.displayMode == 'edit'}" />
              <h:outputText value="#{messages['command.edit']}" rendered="#{documentActions.displayMode == 'view'}" />
            </a4j:commandLink>
          </span>
        </div>
        <div style="clear:both;"></div>
      </div>
      <div class="togglePanelBody">
          <nxl:layout name="heading" mode="#{documentActions.displayMode}" value="#{documentActions.currentSelection}" />
          <nxl:layout name="damc" mode="#{documentActions.displayMode}" value="#{documentActions.currentSelection}" />
          <nxl:layout name="dublincore" mode="#{documentActions.displayMode}" value="#{documentActions.currentSelection}" />

          <h:panelGrid class="dataOutput" columnClasses="labelColumn, fieldColumn" columns="2">
            <h:outputText value="#{messages['label.content.size']}" />
            <h:panelGroup>
              <h:outputText value="#{documentActions.currentSelection.picture.views[1].content.length}" rendered="#{documentActions.currentSelection.hasSchema('picture') and !empty documentActions.currentSelection.picture.views}" />
              <h:outputText value="#{documentActions.currentSelection.file.content.length}" rendered="#{documentActions.currentSelection.hasSchema('file')}" />
            </h:panelGroup>
          </h:panelGrid>
          <h:panelGrid class="dataOutput" columnClasses="labelColumn, fieldColumn" columns="2" rendered="#{documentActions.currentSelection.hasSchema('picture') and !empty documentActions.currentSelection.picture.views}">
            <h:outputText value="#{messages['label.content.height']}" />
            <h:outputText value="#{currentSelection.picture.views[1].height}" />

            <h:outputText value="#{messages['label.content.width']}" />
            <h:outputText value="#{currentSelection.picture.views[1].width}" />
          </h:panelGrid>
      </div>
    </div>

    <div class="togglePanel">
      <div class="togglePanelTitleBox">
	    <h3>
	      <a href="#nogo" class="folded" onclick="return togglePanel(this)">
	        <h:outputText value="#{messages['label.header.info.iptc']}"/>
	      </a>
	    </h3>
	    <div style="clear:both;"></div>
	  </div>
      <div class="togglePanelBody" style="display:none">
        <h:outputText value="#{messages['label.header.info.iptc']}"/>
      </div>
    </div>

    <div class="togglePanel">
      <div class="togglePanelTitleBox">
	    <h3>
	      <a href="#nogo" class="folded" onclick="return togglePanel(this)">
	        <h:outputText value="#{messages['label.header.info.xmp']}"/>
	      </a>
	    </h3>
	    <div style="clear:both;"></div>
      </div>
      <div class="togglePanelBody" style="display:none">
        <h:outputText value="#{messages['label.header.info.xmp']}"/>
      </div>
    </div>

    <div class="togglePanel">
      <div class="togglePanelTitleBox">
        <h3>
          <a href="#nogo" class="folded" onclick="return togglePanel(this)">
            <h:outputText value="#{messages['label.header.info.exif']}"/>
          </a>
        </h3>
        <div style="clear:both;"></div>
      </div>
      <div class="togglePanelBody" style="display: none">
        <h:outputText value="#{messages['label.header.info.exif']}"/>
      </div>
    </div>
  </a4j:form>

</div>