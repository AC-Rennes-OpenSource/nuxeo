<div xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:nxd="http://nuxeo.org/nxweb/document"
  xmlns:nxl="http://nuxeo.org/nxforms/layout" class="docDiffResult">
  
  <c:if test="#{!diffActions.documentDiffAvailable}">
    <h2>
      <h:outputText value="#{messages['document.diff.noDiffAvailable']}"/>
    </h2>
  </c:if>
  <c:if test="#{diffActions.documentDiffAvailable}">
    
    <nxu:set var="leftDoc" value="#{diffActions.leftDoc}" cache="true">
    <nxu:set var="rightDoc" value="#{diffActions.rightDoc}" cache="true">

    <h:form id="document_diff">
  
      <div id="diffHeader">
        <table class="dataInput">
          <tr>
            <td class="labelColumn">
              <h2>
                <h:outputText value="#{messages['document.diff.title']}" />
              </h2>
            </td>
            <td class="fieldColumn">
              <ui:include src="/incl/diff/doc_title_link.xhtml">
                <ui:param name="doc" value="#{leftDoc}" />
              </ui:include>
            </td>
            <td class="fieldColumn">
              <ui:include src="/incl/diff/doc_title_link.xhtml">
                <ui:param name="doc" value="#{rightDoc}" />
              </ui:include>
            </td>
            <td class="contentDiffColumn">
              <c:if test="#{diffActions.versionDiff}">
                <nxd:restDocumentLink document="#{currentDocument}" tab="TAB_CONTENT_HISTORY"
                  subTab="TAB_VERSIONS" styleClass="docLink">
                  <h:outputText value="#{messages['document.diff.backToVersions']}" />
                </nxd:restDocumentLink>
              </c:if>
            </td>
          </tr>
        </table>
        <h:outputText value="#{messages['document.diff.subTitle']}" styleClass="diffSubTitle" />
      </div>
    
      <c:if test="#{empty defaultDiffDisplayBlocks}">
        <h3>
          <h:outputText value="#{messages['document.diff.emptyDiff']}"/>
        </h3>
      </c:if>
    
      <c:if test="#{!empty defaultDiffDisplayBlocks}">        
        <c:forEach items="#{defaultDiffDisplayBlocks}" var="diffDisplayBlock">
          <div class="foldableBox">
            <h3 class="unfolded">
              <a href="#nologo" onclick="return toggleBox(this)">
                <h:outputText value="#{messages[diffDisplayBlock.label]}" />
              </a>
              <span class="breaker"></span>
            </h3>
            <div class="boxBody">
              <nxl:layout mode="view" definition="#{diffDisplayBlock.layoutDefinition}"
                value="#{diffDisplayBlock}" template="/layouts/layout_diff_template.xhtml"/>
            </div>
          </div>
        </c:forEach>
        <div>
          <h:commandButton value="#{messages['document.diff.refresh']}"
            action="#{diffActions.refresh()}"
            styleClass="button" />
        </div>
        <script>
          jQuery(document).ready(function() {
            jQuery(".widgetHelpLabel").tooltip({relative: true, position: 'bottom center'});
          });
        </script>
      </c:if>
      
    </h:form>
    
    </nxu:set>
    </nxu:set>
    
  </c:if>
  
</div>

