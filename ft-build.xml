<?xml version="1.0"?>
<project name="ft" default="usage" basedir=".">
  
  <property name="pom.file" value="${basedir}/nuxeo-dam-distribution/pom.xml" />
  <property name="mvn.profiles" value="NXP" />
  
  <target name="usage">
    <echo message="usage: ant" />
    <echo message="run-ft                 => run all" />
    <echo message="make-distribution      => make Nuxeo DAM distribution" />
    <echo message="start-jboss            => start JBoss server" />
    <echo message="run-selenium           => run the selenium test" />
    <echo message="stop-jboss             => stop the JBoss server" />
  </target>
  
  <target name="run-ft"
    depends="start-jboss,run-selenium,stop-jboss"
    description="start JBoss, run functional tests, stop JBoss.">
  </target>

  <target name="make-distribution">  
    <exec executable="mvn" failonerror="true">
      <arg value="-f" />
      <arg value="${pom.file}" />
      <arg value="clean" />
      <arg value="package" />
      <arg value="install" />
      <arg value="-P" />
      <arg value="${mvn.profiles}" />
    </exec>
  </target>
  
  <target name="start-jboss">
    <chmod perm="+x"
      file="${basedir}/nuxeo-dam-distribution/nuxeo-dam-distribution-jboss/target/nuxeo-dam-jboss/bin/jbossctl" />
    <exec
      executable="${basedir}/nuxeo-dam-distribution/nuxeo-dam-distribution-jboss/target/nuxeo-dam-jboss/bin/jbossctl">
      <arg value="start" />
    </exec>
    <waitfor>
      <http url="http://localhost:8080/nuxeo/login.jsp" />
    </waitfor>
  </target>
  
  <target name="run-selenium">
    <exec executable=".${basedir}/nuxeo-dam-distribution/nuxeo-dam-ear/ftest/selenium/run.sh" />
  </target>
  
  <target name="stop-jboss">
    <chmod perm="+x"
      file="${basedir}/nuxeo-dam-distribution/nuxeo-dam-distribution-jboss/target/nuxeo-dam-jboss/bin/jbossctl" />
    <exec
      executable="${basedir}/nuxeo-dam-distribution/nuxeo-dam-distribution-jboss/target/nuxeo-dam-jboss/bin/jbossctl">
      <arg value="stop" />
    </exec>
  </target>
  
</project>
