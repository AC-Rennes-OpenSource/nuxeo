<?xml version="1.0"?>

<component name="org.nuxeo.ecm.platform.smart.query.layouts">

  <extension target="org.nuxeo.ecm.platform.forms.layout.WebLayoutManager"
    point="widgettypes">

    <widgetType name="nxql_incremental_smart_query_widget">
      <handler-class>
        org.nuxeo.ecm.platform.forms.layout.facelets.plugins.TemplateWidgetTypeHandler
      </handler-class>
      <property name="template">
        /widgets/nxql_incremental_smart_query_widget.xhtml
      </property>
    </widgetType>

    <widgetType name="incremental_smart_query_condition">
      <handler-class>
        org.nuxeo.ecm.platform.forms.layout.facelets.plugins.TemplateWidgetTypeHandler
      </handler-class>
      <property name="template">
        /widgets/incremental_smart_query_condition_widget.xhtml
      </property>
    </widgetType>

  </extension>

  <extension target="org.nuxeo.ecm.platform.forms.layout.WebLayoutManager"
    point="widgets">

    <!-- 
      <xs:element name="description" type="xs:string"/>
      <xs:element name="subjects" type="nxs:subjectList"/>
      <xs:element name="rights" type="xs:string"/>
      <xs:element name="source" type="xs:string"/>
      <xs:element name="coverage" type="xs:string"/>
      <xs:element name="created" type="xs:date"/>
      <xs:element name="modified" type="xs:date"/>
      <xs:element name="issued" type="xs:date"/>
      <xs:element name="valid" type="xs:date"/>
      <xs:element name="expired" type="xs:date"/>
      <xs:element name="format" type="xs:string"/>
      <xs:element name="language" type="xs:string"/>
      <xs:element name="creator" type="xs:string"/>
      <xs:element name="contributors" type="nxs:contributorList"/>
    -->

    <widget name="smart_query_condition_title"
      type="incremental_smart_query_condition">
      <labels>
        <label mode="any">title</label>
      </labels>
      <translated>true</translated>
      <properties widgetMode="edit">
        <property name="searchField">dc:title</property>
        <propertyList name="availableOperators">
          <value>CONTAINS</value>
          <value>LIKE</value>
          <value>=</value>
        </propertyList>
      </properties>
      <subWidgets>
        <widget name="title" type="text">
          <fields>
            <field>stringValue</field>
          </fields>
        </widget>
      </subWidgets>
    </widget>

    <widget name="smart_query_condition_created"
      type="incremental_smart_query_condition">
      <labels>
        <label mode="any">label.dublincore.created</label>
      </labels>
      <translated>true</translated>
      <properties widgetMode="edit">
        <property name="searchField">dc:created</property>
        <propertyList name="availableOperators">
          <value>&lt;</value>
          <value>&gt;</value>
        </propertyList>
      </properties>
      <subWidgets>
        <widget name="created" type="datetime">
          <fields>
            <field>dateValue</field>
          </fields>
          <properties widgetMode="edit">
            <property name="required">true</property>
            <property name="pattern">#{nxu:basicDateFormater()}</property>
          </properties>
        </widget>
      </subWidgets>
    </widget>

    <widget name="smart_query_condition_contributors"
      type="incremental_smart_query_condition">
      <labels>
        <label mode="any">label.dublincore.contributors</label>
      </labels>
      <translated>true</translated>
      <properties widgetMode="edit">
        <property name="searchField">dc:contributors</property>
        <propertyList name="availableOperators">
          <value>IN</value>
        </propertyList>
      </properties>
      <subWidgets>
        <widget name="contributors" type="template">
          <fields>
            <field>stringListValue</field>
          </fields>
          <properties widgetMode="edit">
            <property name="required">true</property>
          </properties>
          <properties mode="any">
            <property name="template">
              /widgets/user_suggestion_widget_template.xhtml
            </property>
            <property name="userSuggestionSearchType">USER_TYPE</property>
            <property name="hideVirtualGroups">true</property>
          </properties>
        </widget>
      </subWidgets>
    </widget>

  </extension>

  <extension target="org.nuxeo.ecm.platform.forms.layout.WebLayoutManager"
    point="layouts">

    <layout name="nxql_incremental_smart_query">
      <templates>
        <template mode="any">/layouts/layout_default_template.xhtml</template>
      </templates>
      <rows>
        <row>
          <widget>nxql_incremental_smart_query_widget</widget>
        </row>
      </rows>
      <widget name="nxql_incremental_smart_query_widget"
        type="nxql_incremental_smart_query_widget">
        <labels>
          <label mode="any">label.smart.query.build</label>
        </labels>
        <helpLabels>
          <label mode="edit">label.smart.query.build.help</label>
        </helpLabels>
        <translated>true</translated>
        <fields>
          <field></field>
        </fields>
        <properties mode="any">
          <property name="selectionLayout">
            incremental_smart_query_selection
          </property>
          <property name="updateQueryPart">true</property>
        </properties>
        <properties widgetMode="edit">
          <property name="required">true</property>
        </properties>
      </widget>
    </layout>

    <layout name="incremental_smart_query_selection">
      <templates>
        <template mode="any">
          /layouts/incremental_smart_query_selection_layout_template.xhtml
        </template>
      </templates>
      <rows>
        <row name="smart_query_condition_title">
          <widget>smart_query_condition_title</widget>
        </row>
        <row name="smart_query_condition_created">
          <widget>smart_query_condition_created</widget>
        </row>
        <row name="smart_query_condition_contributors">
          <widget>smart_query_condition_contributors</widget>
        </row>
      </rows>
    </layout>

  </extension>

</component>