<div xmlns:c="http://java.sun.com/jstl/core"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:a4j="https://ajax4jsf.dev.java.net/ajax"
  xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:nxh="http://nuxeo.org/nxweb/html">

<a4j:region id="version_list_region" renderRegionOnly="true">
  <h:panelGroup rendered="#{nxd:hasPermission(currentDocument, 'ReadVersion') and
          currentDocument.versionable and
       !(currentDocument.version or currentDocument.proxy)}">

    <h:form rendered="${not empty versionList}">
      
      <table class="dataOutput">
        <thead>
          <tr>
            <th></th>
            <th>
              <h:outputText value="#{messages['label.version']}" />
            </th>
            <th>
              <h:outputText value="#{messages['label.action']}" />
            </th>
          </tr>
        </thead>
        <tbody>
        <c:forEach var="versionItem" items="#{versionList}" varStatus="status">
          <tr class="#{status.index % 2 == 0 ? 'dataRowEven' : 'dataRowOdd'}">
            <td>
              <h:selectBooleanCheckbox value="#{versionItem.selected}">
                <a4j:support id="ajax_onclick_#{versionItem.id}" event="onclick"
                  action="#{versionedActions.checkCurrentDocAndProcessVersionSelectRow(versionItem, currentDocument.ref)}"
                  reRender="version_ajax_selection_buttons" />
              </h:selectBooleanCheckbox>
            </td>
            <td>
              <h:outputText value="#{versionItem.description}" />
            </td>
            <td>
              <ui:insert name="document_versions_buttons" />
            </td>
          </tr>
        </c:forEach>
        </tbody>
      </table>
      
      <a4j:outputPanel id="version_ajax_selection_buttons">
        <div id="version_selection_buttons">
          <table>
            <tbody>
              <tr>
                <td>
                  <nxu:set var="actions" value="#{webActions.getUnfiltredActionsList('CURRENT_VERSION_SELECTION_LIST')}" cache="true">
                    <nxu:dataList var="sel_action" value="#{actions}"
                      id="versionActionsTable">
                      <span id="#{sel_action.id}">
                        <nxh:commandButton
                          styleClass="button"
                          action="#{sel_action.getLink()}"
                          value="#{messages[sel_action.label]}"
                          onclick="#{sel_action.confirm}"
                          disabled="#{!sel_action.available}"
                          immediate="#{sel_action.immediate}"
                          id="versionActionsButton" />
                       </span>
                    </nxu:dataList>
                  </nxu:set>
                </td>
                <td valign="middle">
                  <a4j:status>
                    <f:facet name="start">
                      <h:graphicImage value="/img/standart_waiter.gif" />
                    </f:facet>
                  </a4j:status>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </a4j:outputPanel>
      
    </h:form>

    <p><h:outputText rendered="${empty versionList}"
      value="#{messages['label.noversion']}"/></p>
   
   </h:panelGroup>
</a4j:region>
</div>
