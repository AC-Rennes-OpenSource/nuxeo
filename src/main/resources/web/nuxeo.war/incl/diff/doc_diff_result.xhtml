<div xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:nxd="http://nuxeo.org/nxweb/document"
  xmlns:nxl="http://nuxeo.org/nxforms/layout" class="docDiffResult">
  
  <style type="text/css">
    /*
    div .emptyTextDiff {width: 60px;}    
    div.textDiff, div .emptyTextDiff {float: left; margin-bottom: 0.1em; padding: 0 0.4em;}
    .listItemIndex {float: left; padding-right: 0.5em; font-style: italic;}
    .textDiff.leftDiff, .emptyTextDiff.leftDiff {background-color:#FFDDDD;}
    .textDiff.rightDiff, .emptyTextDiff.rightDiff {background-color:#DDFFDD;}
    .italic {font-style: italic;}
    */
    
    table.diffHeader {width: 100%; margin-bottom: 10px;}
    .diffHeader a.docLink, .diffHeader a.docLink:link, .diffHeader a.docLink:hover {color: #000000;}
    .docDiffResult .dataInput {width: 100%;}
    .docDiffResult .labelColumn {width: 16%; text-align: left;}
    .docDiffResult .fieldColumn {width: 42%;}
    .docDiffResult .dataInput td {padding: 0.4em 0.3em;}
    .docDiffResult .dataInput td.labelColumn {padding-right: 20px;}
    /*.docDiffResult .dataInput .diffDisplayTable {width: 100%;}*/
    .docDiffResult .dataInput .diffDisplayTable th, .docDiffResult .dataInput .diffDisplayTable td {border: 1px solid #E7E7E7; padding: 0.4em 0.5em;}
    .docDiffResult .dataInput .diffDisplayTable th {background-color:  #EEEFF0; text-align: center; font-weight: bold;}
    .docDiffResult .note_content_block {border:none; margin: 0; padding: 0;}
    
  </style>
  
  <c:if test="#{!diffActions.documentDiffAvailable}">
    <h2>
      <h:outputText value="#{messages['document.diff.noDiffAvailable']}"/>
    </h2>
  </c:if>
  <c:if test="#{diffActions.documentDiffAvailable}">
    
    <nxu:set var="leftDoc" value="#{diffActions.leftDoc}" cache="true">
    <nxu:set var="rightDoc" value="#{diffActions.rightDoc}" cache="true">

    <h:form id="document_diff">
  
      <table class="diffHeader">
        <tr>
          <td class="labelColumn">
            <h2>
              <h:outputText value="#{messages['document.diff.title']}" />
            </h2>
          </td>
          <td class="fieldColumn">
            <ui:include src="/incl/diff/doc_title_link.xhtml">
              <ui:param name="doc" value="#{leftDoc}" />
            </ui:include>
          </td>
          <td class="fieldColumn">
            <ui:include src="/incl/diff/doc_title_link.xhtml">
              <ui:param name="doc" value="#{rightDoc}" />
            </ui:include>
          </td>
        </tr>
      </table>
    
      <c:if test="#{empty defaultDiffDisplayBlocks}">
        <h3>
          <h:outputText value="#{messages['document.diff.emptyDiff']}"/>
        </h3>
      </c:if>
    
      <c:if test="#{!empty defaultDiffDisplayBlocks}">        
        <c:forEach items="#{defaultDiffDisplayBlocks}" var="diffDisplayBlock">
          <div class="foldableBox">
            <h3 class="unfolded">
              <a href="#nologo" onclick="return toggleBox(this)">
                <h:outputText value="#{messages[diffDisplayBlock.label]}" />
              </a>
              <span class="breaker"></span>
            </h3>
            <div class="boxBody">
              <nxl:layout mode="view" definition="#{diffDisplayBlock.layoutDefinition}"
                value="#{diffDisplayBlock}" template="/layouts/layout_diff_template.xhtml"/>
            </div>
          </div>
        </c:forEach>
        
        <div>
          <h:commandButton value="#{messages['document.diff.refresh']}"
            action="#{diffActions.refresh()}"
            styleClass="button" />
        </div>
        
        <script>
          jQuery(document).ready(function() {
            jQuery(".widgetHelpLabel").tooltip({relative: true, position: 'bottom center'});
          });
        </script>        
      </c:if>
      
    </h:form>
    
    </nxu:set>
    </nxu:set>
    
  </c:if>
  
</div>

