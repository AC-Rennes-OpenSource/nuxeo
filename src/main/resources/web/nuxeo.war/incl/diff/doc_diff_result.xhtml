<div xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:nxu="http://nuxeo.org/nxweb/util">
  
  <style type="text/css">
    .diffTable {width: 100%; border-collapse: collapse;}
    .fieldLabelColumn {width: 20%; font-weight: bold;}
    .fieldDiffColumn {width: 40%; padding: 0.4em 0.3em;}
    .textDiff {padding: 0.1em 0.4em;}
    .emptyTextDiff {display: block; height: 16px; width: 60px; margin-bottom: 0.1em;}
    .leftDiff {background-color:#FFDDDD;}
    .rightDiff {background-color:#DDFFDD;}
    .complexDiffTable th, .complexDiffTable td {border: 1px solid #E7E7E7; padding: 0.4em 0.5em;}
    .complexDiffTable th {background-color:  #EEEFF0; text-align: center; font-weight: bold;}
  </style>
  
  <nxu:set var="docDiff" value="#{documentDiffActions.documentDiff}" cache="true">
  
    <ui:repeat value="#{docDiff.schemaNames}" var="schemaName">
      <nxu:set var="schemaDiff" value="#{docDiff.getSchemaDiff(schemaName)}" cache="false">

        <div class="foldableBox">
          <h3 class="folded">
            <a href="#nologo" onclick="return toggleBox(this)">
              <h:outputText value="#{messages[schemaName]}" />
            </a>
            <span class="breaker"></span>
          </h3>
          <div class="boxBody">
            <nxu:dataTable id="schemaDiffTable_#{schemaName}" styleClass="diffTable"
              value="#{schemaDiff.fieldNames}" var="fieldName">
              <nxu:column styleClass="fieldLabelColumn">
                <h:outputText value="#{messages[fieldName]}"/>
              </nxu:column>
              <nxu:column styleClass="fieldDiffColumn">
                <nxu:set var="fieldDiff" value="#{schemaDiff.getFieldDiff(fieldName)}">                  
                  
                  <!-- Simple property -->
                  <f:subview rendered="#{fieldDiff.propertyType.name() == 'simple'}">
                    <ui:include src="/incl/diff/simple_property_diff_left_value.xhtml">
                      <ui:param name="simplePropertyDiff" value="#{fieldDiff}"/>
                    </ui:include>
                  </f:subview>
                  
                  <!-- Complex property -->
                  <f:subview rendered="#{fieldDiff.propertyType.name() == 'complex'}">
                    <ui:include src="/incl/diff/complex_property_diff.xhtml">
                      <ui:param name="complexPropertyDiff" value="#{fieldDiff}"/>
                      <ui:param name="side" value="left"/>
                    </ui:include>
                  </f:subview>
                  
                  <!-- Simple list property -->
                  <f:subview rendered="#{fieldDiff.propertyType.name() == 'list' and fieldDiff.simpleListProperty}">
                    <nxu:dataTable
                      value="#{fieldDiff.diffList}" var="listItem">
                      
                      <nxu:column>
                        <ui:include src="/incl/diff/simple_property_diff_left_value.xhtml">
                          <ui:param name="simplePropertyDiff" value="#{listItem}"/>
                        </ui:include>
                      </nxu:column>
                      
                    </nxu:dataTable>
                  </f:subview>
                  
                  <!-- Complex list property -->
                  <f:subview rendered="#{fieldDiff.propertyType.name() == 'list' and fieldDiff.complexListProperty}">
                    <ui:include src="/incl/diff/complex_list_property_diff.xhtml">
                      <ui:param name="complexListPropertyDiff" value="#{fieldDiff}"/>
                      <ui:param name="side" value="left"/>
                    </ui:include>
                  </f:subview>
                  
                </nxu:set>
              </nxu:column>
              <nxu:column styleClass="fieldDiffColumn">
                <nxu:set var="fieldDiff" value="#{schemaDiff.getFieldDiff(fieldName)}">                  
                  
                  <!-- Simple property -->
                  <f:subview rendered="#{fieldDiff.propertyType.name() == 'simple'}">
                    <ui:include src="/incl/diff/simple_property_diff_right_value.xhtml">
                      <ui:param name="simplePropertyDiff" value="#{fieldDiff}"/>
                    </ui:include>
                  </f:subview>
                  
                  <!-- Complex property -->
                  <f:subview rendered="#{fieldDiff.propertyType.name() == 'complex'}">
                    <ui:include src="/incl/diff/complex_property_diff.xhtml">
                      <ui:param name="complexPropertyDiff" value="#{fieldDiff}"/>
                      <ui:param name="side" value="right"/>
                    </ui:include>
                  </f:subview>
                  
                  <!-- Simple list property -->
                  <f:subview rendered="#{fieldDiff.propertyType.name() == 'list' and fieldDiff.simpleListProperty}">
                    <nxu:dataTable
                      value="#{fieldDiff.diffList}" var="listItem">
                      
                      <nxu:column rendered="#{listItem.propertyType.name() == 'simple'}">
                        <ui:include src="/incl/diff/simple_property_diff_right_value.xhtml">
                          <ui:param name="simplePropertyDiff" value="#{listItem}"/>
                        </ui:include>
                      </nxu:column>
                      
                    </nxu:dataTable>
                  </f:subview>
                  
                  <!-- Complex list property -->
                  <f:subview rendered="#{fieldDiff.propertyType.name() == 'list' and fieldDiff.complexListProperty}">
                    <ui:include src="/incl/diff/complex_list_property_diff.xhtml">
                      <ui:param name="complexListPropertyDiff" value="#{fieldDiff}"/>
                      <ui:param name="side" value="right"/>
                    </ui:include>
                  </f:subview>
                  
                </nxu:set>
              </nxu:column>
            </nxu:dataTable>
          </div>
        </div>
        
      </nxu:set>
    </ui:repeat>
    
  </nxu:set>
  <div>
    <h:form>
      <h:commandButton value="#{messages['document.diff.refresh']}"
        action="#{documentDiffActions.diffCurrentSelection()}"
        styleClass="button" />
    </h:form>
  </div>
  
</div>
