<div xmlns:h="http://java.sun.com/jsf/html"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:a4j="https://ajax4jsf.dev.java.net/ajax"
  xmlns:nxl="http://nuxeo.org/nxforms/layout"
  xmlns:nxu="http://nuxeo.org/nxweb/util">

<c:if test="#{not currentWidgetType.previewEnabled}">
  Preview is not enabled for this widget type.
</c:if>

<c:if test="#{currentWidgetType.previewEnabled}">

  <div class="tabsBar subtabsBar">

    <ul>
      <li class="#{nxu:test(empty layoutDemoCurrentSubTabId, 'selected', '')}">
        <a href="#{baseURL}#{currentWidgetType.url}?tabId=preview">
          #{messages['label.layoutDemo.widgetDemo.viewMode']}
        </a>
      </li>
      <li class="#{nxu:test(layoutDemoCurrentSubTabId == 'edit_mode', 'selected', '')}">
        <a href="#{baseURL}#{currentWidgetType.url}?tabId=preview&amp;subTabId=edit_mode">
          #{messages['label.layoutDemo.widgetDemo.editMode']}
        </a>
      </li>
    </ul>
  </div>
  <div style="clear:both"></div>
  <div class="tabsContent">
  
    <c:if test="#{empty layoutDemoCurrentSubTabId}">

      <table class="dataOutput">
        <thead>
          <tr>
            <th>
              #{messages['label.layoutDemo.widgetPreview.properties']}
            </th>
            <th>
              #{messages['label.layoutDemo.widgetPreview.preview']}
            </th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td width="50%" valign="top">
              <a4j:region id="layoutDemoViewPreviewRegion">
                <a4j:form id="layoutDemoViewPreviewForm"
                  ajaxSubmit="true">
                  <nxl:layout name="layout_demo_widget_common_settings"
                    mode="edit" value="#{viewPreviewLayoutDef}" />
                  <c:forEach var="layoutDef"
                    items="#{currentWidgetTypeConf.getPropertyLayouts('view', 'any')}">
                    <nxl:layout definition="#{layoutDef}"
                      mode="edit_demo_preview"
                      value="#{viewPreviewLayoutDef.properties}"
                      template="/layouts/layout_default_template.xhtml" />
                  </c:forEach>
                  <nxl:layout name="layout_demo_widget_custom_properties"
                    mode="edit" value="#{viewPreviewLayoutDef}" />
                  <p class="buttonsGadget">
                    <a4j:commandButton
                      value="#{messages['label.layoutDemo.widgetDemo.submit']}"
                      styleClass="button"
                      id="#{demoLayout.name}_edit_form_submitButton"
                      reRender="layoutDemoViewPreviewForm, layoutDemoViewPreview">
                      <nxu:actionListenerMethod
                        value="#{layoutDemoActions.setShowViewPreview(true)}" /> 
                    </a4j:commandButton>
                    <a4j:status>
                      <f:facet name="start">
                        <h:graphicImage value="/img/standart_waiter.gif" />
                      </f:facet>
                    </a4j:status>
                  </p>
                </a4j:form>
              </a4j:region>
            </td>
            <td width="50%" valign="top">
              <a4j:outputPanel id="layoutDemoViewPreview">
                <c:if test="#{layoutDemoActions.showViewPreview}">
                  <c:if test="false">
                    <c:set var="frameURL"
                      value="#{baseURL}#{layoutPreviewActions.getPreviewLayoutURL(viewPreviewLayoutDef, 'view', '/layouts/layout_default_template.xhtml')}" />
                    <iframe style="visibility:hidden;width:100%;"
                      onload="javascript:this.style.visibility='visible';"
                      src="#{frameURL}"></iframe>
                  </c:if>
                  <c:if test="true">
                    <h:form id="layoutDemoViewPreviewResultForm"
                      ajaxSubmit="true">
                      <nxl:layout
                        definition="#{layoutPreviewActions.getLayoutDefinition(viewPreviewLayoutDef)}"
                        value="#{layoutPreviewDocument}" mode="view"
                        template="/layouts/layout_default_template.xhtml" />
                    </h:form>
                  </c:if>
                </c:if>
              </a4j:outputPanel>
            </td>
          </tr>
        </tbody>
      </table>

    </c:if>

    <c:if test="#{layoutDemoCurrentSubTabId == 'edit_mode'}">

      <table class="dataOutput">
        <thead>
          <tr>
            <th>
              #{messages['label.layoutDemo.widgetPreview.properties']}
            </th>
            <th>
              #{messages['label.layoutDemo.widgetPreview.preview']}
            </th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td width="50%" valign="top">
              <a4j:region id="layoutDemoEditPreviewRegion">
                <a4j:form id="layoutDemoEditPreviewForm"
                  ajaxSubmit="true">
                  <nxl:layout name="layout_demo_widget_common_settings"
                    mode="edit" value="#{editPreviewLayoutDef}" />
                  <c:forEach var="layoutDef"
                    items="#{currentWidgetTypeConf.getPropertyLayouts('edit', 'any')}">
                    <nxl:layout definition="#{layoutDef}"
                      mode="edit_demo_preview"
                      value="#{editPreviewLayoutDef.properties}"
                      template="/layouts/layout_default_template.xhtml" />
                  </c:forEach>
                  <nxl:layout name="layout_demo_widget_custom_properties"
                    mode="edit" value="#{editPreviewLayoutDef}" />
                  <p class="buttonsGadget">
                    <a4j:commandButton
                      value="#{messages['label.layoutDemo.widgetDemo.submit']}"
                      styleClass="button"
                      id="#{demoLayout.name}_edit_form_submitButton"
                      process="layoutDemoEditPreviewForm"
                      reRender="layoutDemoEditPreviewForm, layoutDemoEditPreview">
                      <nxu:actionListenerMethod
                        value="#{layoutDemoActions.setShowEditPreview(true)}" /> 
                    </a4j:commandButton>
                    <a4j:status>
                      <f:facet name="start">
                        <h:graphicImage value="/img/standart_waiter.gif" />
                      </f:facet>
                    </a4j:status>
                  </p>
                </a4j:form>
              </a4j:region>
            </td>
            <td width="50%" valign="top">
              <a4j:outputPanel id="layoutDemoEditPreview">
                <c:if test="#{layoutDemoActions.showEditPreview}">
                  <c:if test="false">
                    <c:set var="frameURL"
                      value="#{baseURL}#{layoutPreviewActions.getPreviewLayoutURL(editPreviewLayoutDef, 'edit', '/layouts/layout_default_template.xhtml')}" />
                    <iframe style="visibility:hidden;width:100%;"
                      onload="javascript:this.style.visibility='visible';"
                      src="#{frameURL}"></iframe>
                  </c:if>
                  <c:if test="true">
                    <h:form id="layoutDemoEditPreviewResultForm"
                      ajaxSubmit="true">
                      <nxl:layout
                        definition="#{layoutPreviewActions.getLayoutDefinition(editPreviewLayoutDef)}"
                        value="#{layoutPreviewDocument}" mode="edit"
                        template="/layouts/layout_default_template.xhtml" />
                    </h:form>
                  </c:if>
                </c:if>
              </a4j:outputPanel>
            </td>
          </tr>
        </tbody>
      </table>

    </c:if>

  </div>

</c:if>

</div>