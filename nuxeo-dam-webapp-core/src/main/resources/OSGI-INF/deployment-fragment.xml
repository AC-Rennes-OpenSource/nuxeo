<?xml version="1.0"?>
<fragment version="1">

  <extension target="web#STD-AUTH-FILTER">
    <filter-mapping>
      <filter-name>NuxeoAuthenticationFilter</filter-name>
      <url-pattern>/nxpicsfile/*</url-pattern>
      <dispatcher>REQUEST</dispatcher>
      <dispatcher>FORWARD</dispatcher>
    </filter-mapping>
    <filter-mapping>
      <filter-name>NuxeoAuthenticationFilter</filter-name>
      <url-pattern>/nxdam/*</url-pattern>
      <dispatcher>REQUEST</dispatcher>
      <dispatcher>FORWARD</dispatcher>
    </filter-mapping>
    <filter-mapping>
      <filter-name>NuxeoAuthenticationFilter</filter-name>
      <url-pattern>/nxdam/*</url-pattern>
      <dispatcher>REQUEST</dispatcher>
      <dispatcher>FORWARD</dispatcher>
    </filter-mapping>
  </extension>

  <extension target="application#MODULE">
    <module>
      <ejb>${bundle.fileName}</ejb>
    </module>
  </extension>

  <extension target="web#FILTER-MAPPING">
    <!--
      Seam Context Filter is declared in org.nuxeo.ecm.platform.ui.web
      deployment fragment
    -->
    <filter-mapping>
      <filter-name>Seam Context Filter</filter-name>
      <url-pattern>/DocumentManagerWS</url-pattern>
    </filter-mapping>
  </extension>

  <extension target="faces-config#NAVIGATION">

    <navigation-case>
      <from-outcome>assets</from-outcome>
      <to-view-id>/assets.xhtml</to-view-id>
      <redirect />
    </navigation-case>

    <navigation-case>
      <from-outcome>home</from-outcome>
      <to-view-id>/nxstartup.xhtml</to-view-id>
      <redirect />
    </navigation-case>

    <navigation-case>
      <from-outcome>annotations_popup</from-outcome>
      <to-view-id>/annotations_popup.xhtml</to-view-id>
    </navigation-case>

  </extension>

  <extension target="pages#PAGES">

    <!-- Post login and 'home' view handler -->
    <page view-id="/nxstartup.xhtml" action="#{startupHelper.initDomainAndFindStartupPage()}" />

  </extension>

</fragment>

