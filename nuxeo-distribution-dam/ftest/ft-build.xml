<?xml version="1.0"?>
<project name="ft" default="usage" basedir="..">

  <property name="pom.file" value="${basedir}/pom.xml" />
  <property name="mvn.profiles" value="NXP" />

  <target name="usage">
    <echo message="usage: ant" />
    <echo message="make-distribution             => make Nuxeo DAM JBoss distribution" />
    <echo message="make-tomcat-distribution      => make Nuxeo DAM Tomcat distribution" />
    <echo message="start-jboss                   => start JBoss server" />
    <echo message="start-tomcat                  => start Tomcat server" />
    <echo message="stop-jboss                    => stop the JBoss server" />
    <echo message="stop-tomcat                   => stop the Tomcat server" />
  </target>

  <target name="make-distributions">
    <exec executable="mvn" failonerror="true">
      <arg value="clean" />
      <arg value="install" />
      <arg value="-P" />
      <arg value="all-distributions" />
      <arg value="-P" />
      <arg value="${mvn.profiles}" />
    </exec>
  </target>

  <target name="start-jboss">
    <chmod perm="+x"
      file="${basedir}/target/jboss/bin/nuxeoctl" />
    <exec
      executable="${basedir}/target/jboss/bin/nuxeoctl">
      <arg value="start" />
    </exec>
    <waitfor>
      <http url="http://localhost:8080/nuxeo/login.jsp" />
    </waitfor>
  </target>

  <target name="stop-jboss">
    <chmod perm="+x"
      file="${basedir}/target/jboss/bin/nuxeoctl" />
    <exec
      executable="${basedir}/target/jboss/bin/nuxeoctl">
      <arg value="stop" />
    </exec>
  </target>

  <target name="start-tomcat">
    <chmod perm="+x"
      dir="${basedir}/target/tomcat/bin" includes="**/*.sh, **/*ctl"/>
    <exec
      executable="${basedir}/target/tomcat/bin/nuxeoctl">
      <arg value="start" />
    </exec>
    <waitfor>
      <http url="http://localhost:8080/nuxeo/login.jsp" />
    </waitfor>
  </target>

  <target name="stop-tomcat">
    <exec
      executable="${basedir}/target/tomcat/bin/nuxeoctl">
      <arg value="stop" />
    </exec>
  </target>
</project>
