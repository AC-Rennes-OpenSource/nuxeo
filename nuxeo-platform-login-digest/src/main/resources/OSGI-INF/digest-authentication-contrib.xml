<?xml version="1.0"?>
<component name="org.nuxeo.ecm.platform.login.digest">

    <require>org.nuxeo.ecm.platform.ui.web.auth.defaultConfig</require>
    <require>org.nuxeo.ecm.automation.server.auth.config</require>
    <require>org.nuxeo.ecm.webengine.blogs.authConfig</require>
    <require>org.nuxeo.ecm.platform.ui.web.auth.WebEngineConfig</require>
    <require>org.nuxeo.opensocial.OAuthFilter</require>

    <extension
            target="org.nuxeo.ecm.platform.ui.web.auth.service.PluggableAuthenticationService"
            point="authenticators">
        <authenticationPlugin
                name="DIGEST_AUTH"
                enabled="true"
                class="org.nuxeo.ecm.ui.web.auth.digest.DigestAuthenticator">
            <loginModulePlugin>DigestLoginPlugin</loginModulePlugin>
        </authenticationPlugin>
    </extension>

    <extension
            target="org.nuxeo.ecm.platform.ui.web.auth.service.PluggableAuthenticationService"
            point="chain">
        <authenticationChain>
            <plugins>
                <plugin>BASIC_AUTH</plugin>
                <plugin>FORM_AUTH</plugin>
                <plugin>DIGEST_AUTH</plugin>
                </plugins>
        </authenticationChain>
    </extension>

    <extension target="org.nuxeo.ecm.platform.login.LoginPluginRegistry" point="plugin">
        <LoginPlugin name="DigestLoginPlugin"
                     class="org.nuxeo.ecm.ui.web.auth.digest.DigestLoginPlugin">
            <enabled>true</enabled>
        </LoginPlugin>
    </extension>

    <extension
            target="org.nuxeo.ecm.platform.ui.web.auth.service.PluggableAuthenticationService"
            point="specificChains">

        <specificAuthenticationChain name="WSS">
            <urlPatterns>
                <url>(.*)/_vti_.*</url>
            </urlPatterns>
            <headers>
                <header name="User-Agent">MSFrontPage.*</header>
            </headers>

            <allowedPlugins>
                <plugin>DIGEST_AUTH</plugin>
                <plugin>BASIC_AUTH</plugin>
            </allowedPlugins>
        </specificAuthenticationChain>
    </extension>

    <extension
            target="org.nuxeo.ecm.platform.ui.web.auth.service.PluggableAuthenticationService"
            point="specificChains">

        <specificAuthenticationChain name="WebDAV">
            <headers>
                <header name="User-Agent">Microsoft-WebDAV-MiniRedir.*</header>
            </headers>

            <allowedPlugins>
                <plugin>DIGEST_AUTH</plugin>
                <plugin>BASIC_AUTH</plugin>
            </allowedPlugins>
        </specificAuthenticationChain>
    </extension>

</component>
