<div xmlns:c="http://java.sun.com/jstl/core"
  xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:nxd="http://nuxeo.org/nxweb/document"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:nxl="http://nuxeo.org/nxforms/layout"
  xmlns:nxh="http://nuxeo.org/nxweb/html"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:f="http://java.sun.com/jsf/core"
  id="#{widget.id}">

<c:if test="#{widget.mode == 'edit'}">
<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.0/themes/base/jquery-ui.css" />
<script src="http://code.jquery.com/ui/1.10.0/jquery-ui.js"></script>
<script>
jQuery.noConflict();

<h:outputText  value="var currentSliderValue='#{field}';" />
<h:outputText  value="var maxQuotaSliderValue='#{quotaStatsActions.getMaxQuotaSliderValue()}';" />
<h:outputText  value="var minQuotaSliderValue='#{quotaStatsActions.getMinQuotaSliderValue()}';" />

  var GB_label = "#{messages['label.unit.GB']}";
  var MB_label = "#{messages['label.unit.MB']}";
  var KB_label = "#{messages['label.unit.KB']}";
  var B_label = "#{messages['label.unit.B']}";

 
 function expon(value){
    value = Number(value);
    value = Math.exp(value);
    value = Math.round(value / 1000)*1000;
    return value;
    
 }
 function logposition(val){
    return Math.log(val);
 }
 
  function getCurrentSliderValue(){
  if(currentSliderValue == -1){
  	return 0;
  }
  return logposition(currentSliderValue);
  }
 
  function formatQuotaSize(value) {
    var gb = 1024*1024*1024;
    var mb = 1024*1024;
    var kb = 1024;
    var label = "";
    value = Number(value);
    value = Math.exp(value);
    value = Math.round(value / 1000)*1000;
    var label;
    if (value > gb) {
      label = Math.round(value/gb) + " " + GB_label;
    } else if (value > mb) {
      label = Math.round(value/mb) + " " + MB_label;
    } else if (value > kb) {
      label = Math.round(value/kb) + " " + KB_label;
    } else {
     label = value + " " + B_label;
    }
    return label;
  } 
 
  function displayQuotaSize(value) {
    var label = formatQuotaSize(value);
    jQuery('#sliderDisplay').html(label);
    return label;
  } 
  
  jQuery(document).ready(function() {
  
  jQuery( "#slider" ).slider({
  value: Number(getCurrentSliderValue()),
  min: Number(logposition(minQuotaSliderValue)),
  max: Number(logposition(maxQuotaSliderValue)),
  step: 0.001,
  slide: function( event, ui ) {
    jQuery("#sliderValue").text(displayQuotaSize(ui.value));
    console.log(jQuery("inputText[id$='maxValue']").val());
    jQuery("input[id$='maxValue']").val(expon(ui.value));
  }
  });
 
 jQuery("#sliderValue").text(displayQuotaSize(jQuery("#slider").slider("value")));
 jQuery("#limitMin").text(formatQuotaSize(Number(logposition(minQuotaSliderValue))));
 jQuery("#limitMax").text(formatQuotaSize(Number(logposition(maxQuotaSliderValue))));
 
 });
</script>
<table class="dataTableNoBorder">
  <tbody>
      <tr>
      <td class="labelColumn"/>
      <td class="eightyPercent"><span id="sliderValue" style="border: 0; color: #f6931f; font-weight: bold;"></span> </td>
      <td class="labelColumn"/>
    </tr>
    <tr>
      <td class="labelColumn"> <span id="limitMin"></span> </td>
      <td class="eightyPercent"> <div id="slider"></div> </td>
      <td class="labelColumn">  <span id="limitMax"></span>
     </td>
    </tr>
  </tbody>
</table>
 <h:inputText id="maxValue" value="#{field}" style="visibility:hidden"/>
</c:if>
<c:if test="#{widget.mode == 'view'}">
</c:if>
</div>