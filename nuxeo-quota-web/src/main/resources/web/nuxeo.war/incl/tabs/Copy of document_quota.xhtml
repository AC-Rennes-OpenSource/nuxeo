<div xmlns:h="http://java.sun.com/jsf/html"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:nxd="http://nuxeo.org/nxweb/document"
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:a4j="https://ajax4jsf.dev.java.net/ajax"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:nxl="http://nuxeo.org/nxforms/layout">

<h:form enctype="multipart/form-data" id="quota_edit">

  <script>

  var GB_label = "GB";
  var MB_label = "MB";
  var KB_label = "KB";
  var B_label = "B";

  jQuery(document).ready(function() {
    setInitialValue(27813000);
    jQuery("#quota_edit\\:sliderInput").css("display","none");
  });

  function setInitialValue(value) {
    value = Number(value);
    if (value == -1) {
      setUnlimited(true);
    } else {
      value = Math.log(value);
      console.log(value);
      var sVal = jQuery("#quota_edit\\:slider").find("input");
      sVal.val(value);
      sVal.trigger('focus');
      sVal.trigger('blur');
    }
  }

  function changeUnlimited(chk) {
     setUnlimited(jQuery(chk).attr("checked"));
  }

  function setUnlimited(isUnlimited) {
    if (isUnlimited) {
      jQuery("#unlimitedChk").attr("checked", true);
      jQuery('#quota_edit\\:maxValue').val("-1");
      jQuery('#sliderDisplay').html("");
      jQuery("#sliderTable").css("display","none")

    } else {
      jQuery("#unlimitedChk").removeAttr("checked");
      jQuery("#sliderTable").css("display","block")
      var sVal = jQuery("#quota_edit\\:slider").find("input");
      sVal.trigger('focus');
      sVal.trigger('blur');
      displayQuotaSize(sVal.val());
    }
  }

  function displayQuotaSize(value) {
    var gb = 1024*1024*1024;
    var mb = 1024*1024;
    var kb = 1024;
    var label = "";
    value = Number(value);
    value = Math.exp(value);
    value = Math.round(value / 1000)*1000;
    jQuery('#quota_edit\\:maxValue').val(value);
    if (value > gb) {
      label = Math.round(value/gb) + " " + GB_label;
    } else if (value > mb) {
      label = Math.round(value/mb) + " " + MB_label;
    } else if (value > kb) {
      label = Math.round(value/kb) + " " + KB_label;
    } else {
     label = value + " " + B_label;
    }
    jQuery('#sliderDisplay').html(label);
  }
  </script>

  <table>
  <tr>
    <td>
      <input type="checkbox" id="unlimitedChk" onchange="changeUnlimited(this)" /> Unlimited
    </td>
  </tr><tr>
  <td>

    <table id="sliderTable">
    <tr>
    <td></td><td style="text-align:center;font-weight:bold"><span id="sliderDisplay"></span>
    </td><td></td></tr>
    <tr>
    <td>
    100 KB
    </td><td>
    <rich:inputNumberSlider id="slider" width="450px"
            showBoundaryValues="false"
            onchange="displayQuotaSize(this.value);"
            onslide="displayQuotaSize(this.value);"
            showToolTip="false"
            showInput="true"
            maxValue="27.701"
            minValue="11.528" step="0.001"></rich:inputNumberSlider>
    </td>
    <td>
    999 MB
    <h:inputText id="maxValue"/>
    </td>
    </tr>
    </table>
</td></tr>
</table>
  <nxl:layout mode="edit" name="edit_quota" value="#{currentDocument}" />

  <nxl:layout name="document_edit_form_options"
    mode="edit" value="#{currentDocument}" />
</h:form>

  <c:if test="#{currentQuotaDoc!=null}">

    #{currentQuotaDoc.quotaInfo.innerSize.valueInUnit} #{currentQuotaDoc.quotaInfo.innerSize.unit} <br/>
    #{currentQuotaDoc.quotaInfo.totalSize.valueInUnit} #{currentQuotaDoc.quotaInfo.totalSize.unit} <br/>
    #{currentQuotaDoc.quotaInfo.maxQuota.valueInUnit} #{currentQuotaDoc.quotaInfo.maxQuota.unit} <br/>
  </c:if>


</div>